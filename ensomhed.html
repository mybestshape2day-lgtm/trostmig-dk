<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ensomhed - Tr√∏stMig.dk</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; connect-src 'self' https://texttospeech.googleapis.com https://*.googleapis.com; media-src 'self' data: blob:;">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --accent: #7c3aed;
            --accent-hover: #6d28d9;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --text-primary: #f7fafc;
            --text-secondary: #cbd5e0;
            --accent: #9f7aea;
            --accent-hover: #b794f4;
            --border: #4a5568;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        /* Universal Navigation */
        .nav-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 15px 20px;
            z-index: 1000;
            box-shadow: 0 2px 10px var(--shadow);
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-link {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            background: var(--bg-primary);
            color: var(--accent);
        }

        .nav-link.primary {
            background: var(--accent);
            color: white;
        }

        .nav-link.primary:hover {
            background: var(--accent-hover);
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .voice-selector {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 0.9rem;
            cursor: pointer;
            color: var(--text-primary);
        }

        .theme-toggle {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .nav-show-indicator {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 999;
        }

        .nav-show-indicator.show {
            opacity: 1;
        }

        body {
            margin-top: 80px;
        }

        @media (max-width: 768px) {
            .nav-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }
        }

        /* Welcome Screen */
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 1s ease;
        }

        .welcome-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .welcome-message {
            max-width: 700px;
            padding: 40px;
            text-align: center;
            font-size: 1.5rem;
            line-height: 1.8;
            color: var(--text-primary);
            animation: fadeIn 2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .skip-intro {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }



        /* Main Selection Screen */
        .main-selection {
            display: none;
        }

        .main-selection.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .selection-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .selection-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .selection-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .selection-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px var(--shadow);
            border-color: var(--accent);
        }

        .selection-card.urgent {
            border-color: #ef4444;
        }

        .selection-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .selection-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .selection-description {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .time-badge {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        /* Script Display Screen - BLANK SCREEN */
        .script-display {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            z-index: 500;
        }

        .script-display.active {
            display: flex;
            flex-direction: column;
        }

        .script-text {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            overflow-y: auto;
        }

        .script-content {
            max-width: 800px;
            font-size: 1.3rem;
            line-height: 2;
            color: var(--text-primary);
            animation: fadeIn 0.5s ease;
        }

        /* Controls */
        .controls-bar {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 5px 20px var(--shadow);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-btn {
            background: var(--accent);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: var(--accent-hover);
            transform: scale(1.1);
        }

        .favorite-btn {
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
        }

        .favorite-btn.active {
            background: var(--accent);
            color: white;
        }

        .progress-indicator {
            color: var(--text-secondary);
            font-size: 0.9rem;
            padding: 0 10px;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
        }

        /* Loading indicator */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .selection-grid {
                grid-template-columns: 1fr;
            }
            
            .script-content {
                font-size: 1.1rem;
            }
            
            .welcome-message {
                font-size: 1.2rem;
                padding: 20px;
            }

            .nav-controls {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    
    <!-- Welcome Screen -->
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-message" id="welcomeText">
            <!-- Welcome message inserted by JS -->
        </div>
        <button class="skip-intro" onclick="skipIntro()">Spring over</button>
    </div>

    <!-- Universal Navigation -->
    <nav class="nav-header" id="mainNav">
        <div class="nav-content">
            <a href="index.html" class="nav-logo">Tr√∏stMig.dk</a>
            
            <div class="nav-links">
                <a href="login.html" class="nav-link primary">Log ind</a>
                <a href="index.html" class="nav-link">Hovedmenu</a>
                <a href="Dashboard.html" class="nav-link">Dashboard</a>
                <a href="playlists.html" class="nav-link">Playlister</a>
            </div>
            
            <div class="nav-user">
                <select class="voice-selector" id="voiceSelector" onchange="changeVoice()">
                    <option value="da-DK-Chirp3-HD-Charon">Simon - Mand, rolig</option>
                    <option value="da-DK-Chirp3-HD-Sulafat">Anna - Kvinde, varm</option>
                    <option value="da-DK-Chirp3-HD-Vindemiatrix">Maria - Kvinde, rolig</option>
                    <option value="da-DK-Chirp3-HD-Erriapus">Sofie - Kvinde, bl√∏d</option>
                    <option value="da-DK-Chirp3-HD-Enceladus">Lars - Mand, naturlig</option>
                    <option value="da-DK-Chirp3-HD-Rasalgethi">Mikkel - Mand, neutral</option>
                    <option value="da-DK-Chirp3-HD-Sadachbia">Peter - Mand, rolig</option>
                    <option value="da-DK-Chirp3-HD-Schedar">Thomas - Mand, klassisk</option>
                    <option value="da-DK-Chirp3-HD-Callirrhoe">Line - Kvinde, klar</option>
                    <option value="da-DK-Chirp3-HD-Despina">Camilla - Kvinde, lys</option>
                    <option value="da-DK-Chirp3-HD-Umbriel">Henrik - Mand, kraftfuld</option>
                    <option value="da-DK-Chirp3-HD-Sadaltager">Morten - Mand, seri√∏s</option>
                    <option value="da-DK-Chirp3-HD-Zephyr">Emma - Kvinde, let</option>
                </select>
                <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">üåô</button>
            </div>
        </div>
    </nav>

    <div class="nav-show-indicator" id="navIndicator">Ryk mus for at vise menu</div>

    <!-- Main Selection Screen -->
    <div class="main-selection" id="mainSelection">
        <div class="selection-header">
            <h1>Ensomhed</h1>
            <p>V√¶lg hvad du har brug for lige nu</p>
        </div>

        <div class="selection-grid">
            <div class="selection-card urgent" onclick="startSection('akut')">
                <div class="selection-icon">üÜò</div>
                <h2 class="selection-title">Akut ensomhed</h2>
                <p class="selection-description">
                    √òjeblikkelig hj√¶lp n√•r ensomheden f√∏les overv√¶ldende. 
                    Grounding, validering og praktiske √∏velser.
                </p>
                <span class="time-badge">2-10 minutter</span>
            </div>

            <div class="selection-card" onclick="startSection('forst√•else')">
                <div class="selection-icon">üß†</div>
                <h2 class="selection-title">Forst√• ensomhed</h2>
                <p class="selection-description">
                    L√¶r hvorfor ensomhed opst√•r og hvad der sker i kroppen. 
                    Neurobiologi og psykologisk forklaring.
                </p>
                <span class="time-badge">5-15 minutter</span>
            </div>

            <div class="selection-card" onclick="startSection('h√•ndtering')">
                <div class="selection-icon">üéØ</div>
                <h2 class="selection-title">H√•ndter ensomhed</h2>
                <p class="selection-description">
                    Langsigtede strategier for at bygge forbindelse. 
                    Praktiske v√¶rkt√∏jer og √∏velser.
                </p>
                <span class="time-badge">5-20 minutter</span>
            </div>
        </div>
    </div>

    <!-- Script Display Screen -->
    <div class="script-display" id="scriptDisplay">
        <button class="close-btn" onclick="closeScript()">Luk ‚úï</button>
        <div class="script-text">
            <div class="script-content" id="scriptContent">
                <!-- Script content will be displayed here -->
            </div>
        </div>
        <div class="controls-bar">
            <button class="control-btn" onclick="previousScript()">‚óÄ</button>
            <button class="control-btn" onclick="togglePlay()" id="playBtn">‚è∏</button>
            <button class="control-btn" onclick="nextScript()">‚ñ∂</button>
            <button class="control-btn favorite-btn" onclick="toggleFavorite()" id="favoriteBtn">‚òÖ</button>
            <span class="progress-indicator" id="progressIndicator">1 / 15</span>
        </div>
    </div>

    <script>
        // ============ TTS CONFIG ============
        const TTS_CONFIG = {
            API_KEY: 'AIzaSyCKQO9FZXRtRtv6k_XymPXHJHp7hrvjEqk',
            VOICE_VARIATIONS: [
                { name: 'da-DK-Chirp3-HD-Charon', gender: 'MALE', description: 'Simon - Mand, rolig' },
                { name: 'da-DK-Chirp3-HD-Sulafat', gender: 'FEMALE', description: 'Anna - Kvinde, varm' },
                { name: 'da-DK-Chirp3-HD-Vindemiatrix', gender: 'FEMALE', description: 'Maria - Kvinde, rolig' },
                { name: 'da-DK-Chirp3-HD-Erriapus', gender: 'FEMALE', description: 'Sofie - Kvinde, bl√∏d' },
                { name: 'da-DK-Chirp3-HD-Enceladus', gender: 'MALE', description: 'Lars - Mand, naturlig' },
                { name: 'da-DK-Chirp3-HD-Rasalgethi', gender: 'MALE', description: 'Mikkel - Mand, neutral' },
                { name: 'da-DK-Chirp3-HD-Sadachbia', gender: 'MALE', description: 'Peter - Mand, rolig' },
                { name: 'da-DK-Chirp3-HD-Schedar', gender: 'MALE', description: 'Thomas - Mand, klassisk' },
                { name: 'da-DK-Chirp3-HD-Callirrhoe', gender: 'FEMALE', description: 'Line - Kvinde, klar' },
                { name: 'da-DK-Chirp3-HD-Despina', gender: 'FEMALE', description: 'Camilla - Kvinde, lys' },
                { name: 'da-DK-Chirp3-HD-Umbriel', gender: 'MALE', description: 'Henrik - Mand, kraftfuld' },
                { name: 'da-DK-Chirp3-HD-Sadaltager', gender: 'MALE', description: 'Morten - Mand, seri√∏s' },
                { name: 'da-DK-Chirp3-HD-Zephyr', gender: 'FEMALE', description: 'Emma - Kvinde, let' }
            ],
            DEFAULT_SPEED: 0.9,
            AUDIO_ENCODING: 'MP3',
            ENABLE_CACHE: true,
            CACHE_DURATION: 7 * 24 * 60 * 60 * 1000
        };

        // ============ STATE MANAGEMENT ============
        let selectedVoiceIndex = parseInt(localStorage.getItem('selectedVoice')) || 0;
        let currentSection = null;
        let currentScriptIndex = 0;
        let isPlaying = false;
        let currentAudio = null;

        // ============ WELCOME MESSAGES ============
        const welcomeMessages = [
            "Ensomhed er en af de mest universelle menneskelige oplevelser. Du er ikke alene med at f√∏le dig ensom.",
            "Det kr√¶ver mod at anerkende sin ensomhed. Du har taget det f√∏rste skridt ved at v√¶re her.",
            "Ensomhed er ikke et tegn p√• svaghed - det er et signal om at du har brug for forbindelse.",
            "Selv i en fyldt verden kan vi f√∏le os ensomme. Lad os udforske dette sammen.",
            "Din ensomhed er valid. Dine f√∏lelser er vigtige. Du fortjener at blive h√∏rt."
        ];

        // ============ SCRIPTS DATABASE ============
        const scriptsDatabase = {
            akut: [
                {
                    id: 'ensomhed-akut-1',
                    title: "Stop ensomhedsspiralen nu",
                    content: "Tag et dybt √•ndedrag. Jeg ved du har det sv√¶rt lige nu. Ensomheden kan f√∏les som en tung sten i brystet, ikke sandt? Lad os stoppe spiralen sammen. F√∏rst, se dig omkring. N√¶vn fem ting du kan se. S√• fire ting du kan r√∏re ved. Tre lyde du kan h√∏re. To ting du kan lugte. Og √©n ting du kan smage. Dette √∏velse hedder grounding. Den bringer dig tilbage til nuet. Du er her. Du √•nder. Du overlever. Og selvom du f√∏ler dig ensom lige nu, betyder det ikke du altid vil v√¶re det."
                },
                {
                    id: 'ensomhed-akut-2',
                    title: "Du er ikke alene", 
                    content: "H√∏r godt efter. Du er ikke alene med at f√∏le dig ensom. Unders√∏gelser viser at over halvdelen af alle voksne oplever kronisk ensomhed. Det betyder at hvis du sidder p√• en caf√© med 50 mennesker, er der mindst 25 andre der k√¶mper med det samme som dig. Ensomhed er ikke dit personlige nederlag. Det er en menneskelig oplevelse. En normal reaktion p√• manglende forbindelse. Og det vigtigste? Det kan √¶ndre sig. Du har lov til at f√∏le dig ensom. Du har ogs√• lov til at s√∏ge hj√¶lp."
                },
                {
                    id: 'ensomhed-akut-3',
                    title: "N√∏dtelefon til din hjerne",
                    content: "Lige nu f√∏les det m√•ske som om ensomheden aldrig g√•r v√¶k. Men jeg vil give dig fem akutv√¶rkt√∏jer. F√∏rste: Ring til nogen. Hvem som helst. Selv en kort samtale kan bryde isolation. Anden: G√• udenfor. Bare fem minutter i frisk luft. Tredje: Skriv dine f√∏lelser ned. Helt ufilteret. Fjerde: Lyt til noget du elsker. Musik, podcast, lydbog. Femte: Hj√¶lp nogen. Send en besked til en du ikke har h√∏rt fra l√¶nge. Sp√∏rg hvordan de har det. Paradoksalt hj√¶lper det os selv n√•r vi hj√¶lper andre. Pr√∏v √©n af disse inden for de n√¶ste ti minutter. Bare √©n."
                },
                {
                    id: 'ensomhed-akut-4',
                    title: "√Öndedr√¶ts√∏velse mod ensomhed",
                    content: "Luk √∏jnene hvis du kan. L√¶g en h√•nd p√• dit hjerte. M√¶rk det banke. Dette er beviset p√• at du lever. At du er her. Nu skal vi √•nde sammen. Ind gennem n√¶sen i fire. Hold i fire. Ud gennem munden i seks. Igen. Ind to tre fire. Hold to tre fire. Ud to tre fire fem seks. Godt. Hver gang du √•nder ud, forestil dig at du slipper lidt af ensomheden. Det betyder ikke den forsvinder. Men du giver dig selv plads til at √•nde ved siden af den. Forts√¶t i dit eget tempo. Du klarer dette."
                },
                {
                    id: 'ensomhed-akut-5',
                    title: "N√•r natten er v√¶rst",
                    content: "Natten kan forst√¶rke ensomheden. N√•r alle andre sover. N√•r m√∏rket lukker sig om dig. Og tankerne bliver h√∏jere. Hvis du lytter til dette om natten, ved jeg du k√¶mper. S√• lad mig sige det: Det er okay at v√¶re v√•gen. Det er okay at k√¶mpe. Her er hvad du kan g√∏re lige nu. T√¶nd et blidt lys. Ikke det skarpe loftlys. Noget varmt. Lav en kop te. M√•ske kamille. Pak dig ind i et t√¶ppe. Fokuser p√• komforten i disse sm√• ting. Husk: Natten slutter. Lyset kommer altid tilbage."
                }
            ],
            
            forst√•else: [
                {
                    id: 'ensomhed-forst√•else-1',
                    title: "Ensomhedens neurobiologi",
                    content: "Ensomhed er ikke bare en f√∏lelse. Det er et biologisk alarmsystem. Ligesom sult signalerer mangel p√• n√¶ring, signalerer ensomhed mangel p√• social forbindelse. N√•r vi er ensomme, aktiveres de samme hjerneregioner som ved fysisk smerte. Det forklarer hvorfor ensomhed kan g√∏re ondt. Bogstaveligt talt. Din hjerne producerer ogs√• mere kortisol, stress-hormonet. Over tid kan kronisk ensomhed p√•virke immunforsvaret, hjertet og s√∏vnkvaliteten. Men her er det vigtige: Ved at forst√• at ensomhed er et biologisk signal, kan vi stoppe med at skamme os. Der er ikke noget galt med dig. Din hjerne g√∏r pr√¶cis hvad den skal."
                },
                {
                    id: 'ensomhed-forst√•else-2',
                    title: "Forskel p√• at v√¶re alene og f√∏le sig ensom",
                    content: "Du kan sidde i et fyldt rum og f√∏le dig dybt ensom. Du kan v√¶re fysisk alene og f√∏le dig forbundet. Hvorfor? Fordi ensomhed ikke handler om hvor mange mennesker der er omkring dig. Det handler om kvaliteten af forbindelse. Forskning viser at det er bedre at have f√• dybe relationer end mange overfladiske. Ensomhed opst√•r n√•r der er et gab mellem den forbindelse du √∏nsker og den du oplever. Nogle mennesker trives i ensomhed. Andre lider. Begge dele er valide. N√∏glen er at forst√• dit eget behov for forbindelse."
                },
                {
                    id: 'ensomhed-forst√•else-3',
                    title: "Hvorfor moderne samfund skaber ensomhed",
                    content: "Vi lever i den mest forbundne tid i menneskehedens historie. Og samtidig den mest ensomme. Hvorfor? Sociale medier giver illusion af forbindelse uden √¶gte intimitet. Vi flytter oftere. Arbejder mere. Har f√¶rre f√¶llesskaber. Kernen er atomisering. Tidligere var mennesker indlejret i store netv√¶rk. Storfamilie. Lokalmilj√∏. Kirke eller forening. Nu er vi ofte kun to. Eller √©n. Det er ikke din skyld at du f√∏ler dig ensom. Samfundet er designet p√• m√•der der fremmer isolation. Men ved at forst√• dette kan du begynde at s√∏ge bevidst forbindelse."
                },
                {
                    id: 'ensomhed-forst√•else-4',
                    title: "Ensomhedens positive funktion",
                    content: "Det lyder m√•ske m√¶rkeligt, men ensomhed tjener en vigtig funktion. Ligesom smerte f√•r os til at tr√¶kke h√•nden v√¶k fra en varm plade, f√•r ensomhed os til at s√∏ge forbindelse. Det er et evolution√¶rt overlevelsessystem. Vores forf√¶dre der s√∏gte stammen havde st√∏rre chancer for at overleve. Men her er problemet i dag: Systemet er blevet overaktivt. Vi er socialt sultne i et samfund med f√∏lelsesm√¶ssig junk food. Kort sagt: din ensomhed fors√∏ger at hj√¶lpe dig. Den sender et signal. Sp√∏rgsm√•let er hvordan du reagerer p√• det signal."
                },
                {
                    id: 'ensomhed-forst√•else-5',
                    title: "N√•r ensomhed bliver kronisk",
                    content: "Alle f√∏ler sig ensomme sommetider. Det er normalt. Men hvorn√•r bliver det et problem? N√•r ensomheden varer ved. N√•r den p√•virker dit liv dagligt. Kronisk ensomhed er forbundet med h√∏jere risiko for depression, angst, hjertesygdomme, og endda tidlig d√∏d. Men lad mig v√¶re klar: Dette er ikke for at skr√¶mme dig. Det er for at validere alvoren af din oplevelse. Ensomhed er ikke et kosmetisk problem. Det er et reelt sundhedsproblem. Og det fortjener at blive taget alvorligt. Hvis du har f√∏lt dig dybt ensom i mere end seks m√•neder, overvej at tale med en professionel."
                }
            ],
            
            h√•ndtering: [
                {
                    id: 'ensomhed-h√•ndtering-1',
                    title: "Byg mikro-forbindelser",
                    content: "Du beh√∏ver ikke en bedste ven for at bek√¶mpe ensomhed. Start med mikro-forbindelser. Sig godmorgen til buschauff√∏ren. Smile til baristaen. Small talk med naboen. Disse sm√• udvekslinger aktiverer de samme hjerneregioner som dybe samtaler, bare i mindre grad. Forskning viser at selv fem minutters small talk kan forbedre hum√∏r og reducere ensomhed. Trin et: V√¶lg tre steder du kommer regelm√¶ssigt. Butik, caf√©, park. Trin to: V√¶r konsistent. G√• samme steder. Trin tre: Sig bare hej. Det er det. Sm√• forbindelser over tid bygger f√¶llesskab."
                },
                {
                    id: 'ensomhed-h√•ndtering-2',
                    title: "Kvalitet over kvantitet i relationer",
                    content: "En dyb forbindelse med √©t menneske er bedre end overfladisk kontakt med hundrede. Men hvordan bygger man dybde? S√•rbarhed. Det er svaret. Forskning af Bren√© Brown viser at √¶gte forbindelse kr√¶ver mod til at vise sig. Start sm√•t. Del noget lidt personligt. Hvis du f√∏ler dig ensom, sig det. Mennesker responderer p√• autenticitet. Her er en √∏velse: N√¶ste gang nogen sp√∏rger hvordan du har det, giv et √¶rligt svar. Ikke hele historien. Bare lidt mere end fint. Se hvad der sker. Ofte vil du opdage at andre ogs√• lider. Og pludselig f√∏ler I jer begge mindre ensomme."
                },
                {
                    id: 'ensomhed-h√•ndtering-3',
                    title: "Find dit f√¶llesskab",
                    content: "Ensomhed lindres bedst gennem f√¶lles aktivitet. Ikke face-to-face samtale. Men side-by-side oplevelse. Find noget du interesserer dig for. Bogklub. L√∏begruppe. Br√¶tspil. Frivilligt arbejde. Det vigtige er regelm√¶ssighed. M√∏d de samme mennesker gentagne gange. Forskning viser det tager cirka halvtreds timer sammen f√∏r vi f√∏ler casual venskab. Hundrede timer for rigtigt venskab. To hundrede for t√¶t venskab. S√• v√¶r t√•lmodig. Giv det seks m√•neder. Nogle konkrete steder: Meetup dot com. Lokale foreninger. Biblioteker. Kirker eller spirituelle f√¶llesskaber. Din lokale caf√©. Bare m√∏d op. Konsistent."
                },
                {
                    id: 'ensomhed-h√•ndtering-4',
                    title: "Digital detox strategi",
                    content: "Sociale medier lover forbindelse men leverer ofte isolation. Studier viser jo mere tid vi bruger p√• sociale medier, jo mere ensomme f√∏ler vi os. Hvorfor? Sammenligning. FOMO. Overfladiskhed. Her er en pragmatisk plan: Trin et: Identificer dit st√∏rste tidsspilde. Instagram? TikTok? Trin to: S√¶t en timer. Maksimalt tredive minutter dagligt. Trin tre: Erstat tiden med noget aktivt. Ring til nogen. G√• en tur. M√∏d en ven. Det handler ikke om at slette alt. Det handler om bevidst brug. Sp√∏rg dig selv: F√∏ler jeg mig mere eller mindre forbundet efter at bruge dette? Lad svaret guide dig."
                },
                {
                    id: 'ensomhed-h√•ndtering-5',
                    title: "Ensomhed som v√¶kstmulighed",
                    content: "Dette er kontroversielt. Men ensomhed kan v√¶re en d√∏r. Ikke noget du √∏nsker. Men noget der kan l√¶re dig noget. Mange store t√¶nkere, kunstnere, og ledere har brugt perioder med ensomhed til dyb selvrefleksion. Thoreau. Woolf. Mandela. Det betyder ikke du skal elske din ensomhed. Men du kan bruge den. Sp√∏rg: Hvad fort√¶ller min ensomhed mig om mine behov? Hvad har jeg l√¶rt om mig selv i denne sv√¶re tid? Hvordan vil jeg leve anderledes n√•r ensomheden aftager? Brug en journal. Skriv dagligt. M√•ske finder du at ensomheden, s√• smertefuld den er, ogs√• kan v√¶re en l√¶rer."
                }
            ]
        };



        // ============ FAVORITES SYSTEM ============
        function getFavorites() {
            const favs = localStorage.getItem('favorites_ensomhed');
            return favs ? JSON.parse(favs) : [];
        }

        function saveFavorites(favorites) {
            localStorage.setItem('favorites_ensomhed', JSON.stringify(favorites));
        }

        function isFavorite(scriptId) {
            return getFavorites().includes(scriptId);
        }

        function toggleFavorite() {
            const script = scriptsDatabase[currentSection][currentScriptIndex];
            const favorites = getFavorites();
            const index = favorites.indexOf(script.id);
            
            if (index > -1) {
                favorites.splice(index, 1);
                document.getElementById('favoriteBtn').classList.remove('active');
            } else {
                favorites.push(script.id);
                document.getElementById('favoriteBtn').classList.add('active');
            }
            
            saveFavorites(favorites);
        }

        function updateFavoriteButton() {
            const script = scriptsDatabase[currentSection][currentScriptIndex];
            const btn = document.getElementById('favoriteBtn');
            if (isFavorite(script.id)) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        }

        // ============ TRACKING SYSTEM ============
        function trackScriptPlay(scriptId, section) {
            const tracking = JSON.parse(localStorage.getItem('tracking_history') || '[]');
            tracking.push({
                scriptId,
                section,
                topic: 'ensomhed',
                timestamp: new Date().toISOString()
            });
            // Keep only last 100 entries
            if (tracking.length > 100) tracking.shift();
            localStorage.setItem('tracking_history', JSON.stringify(tracking));
        }

        // ============ TTS FUNCTIONS ============
        async function speakText(text) {
            try {
                const voice = TTS_CONFIG.VOICE_VARIATIONS[selectedVoiceIndex];
                
                const requestBody = {
                    input: { text: text },
                    voice: {
                        languageCode: 'da-DK',
                        name: voice.name,
                        ssmlGender: voice.gender
                    },
                    audioConfig: {
                        audioEncoding: TTS_CONFIG.AUDIO_ENCODING,
                        speakingRate: TTS_CONFIG.DEFAULT_SPEED
                    }
                };

                const response = await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${TTS_CONFIG.API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) throw new Error('TTS API error');

                const data = await response.json();
                return playAudioContent(data.audioContent);
                
            } catch (error) {
                console.error('TTS Error:', error);
                // Fallback to browser TTS
                return browserSpeak(text);
            }
        }

        function playAudioContent(base64Audio) {
            return new Promise((resolve) => {
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio = null;
                }

                currentAudio = new Audio(`data:audio/mp3;base64,${base64Audio}`);
                
                currentAudio.onended = () => {
                    isPlaying = false;
                    document.getElementById('playBtn').innerHTML = '‚ñ∂';
                    setTimeout(() => nextScript(), 3000);
                    resolve();
                };

                currentAudio.play();
                isPlaying = true;
                document.getElementById('playBtn').innerHTML = '‚è∏';
            });
        }

        function browserSpeak(text) {
            if (!('speechSynthesis' in window)) return;
            
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'da-DK';
            utterance.rate = TTS_CONFIG.DEFAULT_SPEED;
            
            utterance.onstart = () => {
                isPlaying = true;
                document.getElementById('playBtn').innerHTML = '‚è∏';
            };
            
            utterance.onend = () => {
                isPlaying = false;
                document.getElementById('playBtn').innerHTML = '‚ñ∂';
                setTimeout(() => nextScript(), 3000);
            };
            
            window.speechSynthesis.speak(utterance);
        }

        function stopSpeech() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            window.speechSynthesis.cancel();
            isPlaying = false;
            const btn = document.getElementById('playBtn');
            if (btn) btn.innerHTML = '‚ñ∂';
        }

        // ============ AUTO-HIDE NAVIGATION ============
        let navTimer;
        let isNavHidden = false;
        const nav = document.getElementById('mainNav');
        const indicator = document.getElementById('navIndicator');
        const HIDE_DELAY = 6000;

        function showNav() {
            if (nav && isNavHidden) {
                nav.style.transform = 'translateY(0)';
                nav.style.opacity = '1';
                if (indicator) indicator.classList.remove('show');
                isNavHidden = false;
            }
        }

        function hideNav() {
            if (nav) {
                nav.style.transform = 'translateY(-100%)';
                nav.style.opacity = '0';
                if (indicator) indicator.classList.add('show');
                isNavHidden = true;
            }
        }

        function resetNavTimer() {
            clearTimeout(navTimer);
            showNav();
            navTimer = setTimeout(hideNav, HIDE_DELAY);
        }

        function preventHide() {
            clearTimeout(navTimer);
            showNav();
        }

        function resumeTimer() {
            setTimeout(resetNavTimer, 500);
        }

        // Event listeners for navigation
        document.addEventListener('mousemove', resetNavTimer);
        document.addEventListener('touchstart', resetNavTimer);
        document.addEventListener('touchmove', resetNavTimer);
        document.addEventListener('scroll', resetNavTimer);
        document.addEventListener('keydown', resetNavTimer);

        if (nav) {
            nav.addEventListener('mouseenter', preventHide);
            nav.addEventListener('mouseleave', resumeTimer);
            nav.addEventListener('focusin', preventHide);
            nav.addEventListener('focusout', resumeTimer);
        }

        // ============ VOICE & THEME FUNCTIONS ============
        function changeVoice() {
            const selector = document.getElementById('voiceSelector');
            if (!selector) return;
            
            const selectedVoice = selector.value;
            localStorage.setItem('preferredVoice', selectedVoice);
            
            // Update selected voice index for TTS
            const voiceIndex = TTS_CONFIG.VOICE_VARIATIONS.findIndex(v => v.name === selectedVoice);
            if (voiceIndex !== -1) {
                selectedVoiceIndex = voiceIndex;
                localStorage.setItem('selectedVoice', voiceIndex);
            }
            
            resetNavTimer();
        }

        function toggleTheme() {
            const html = document.documentElement;
            const btn = document.getElementById('themeToggle');
            
            if (html.getAttribute('data-theme') === 'dark') {
                html.removeAttribute('data-theme');
                if (btn) btn.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                if (btn) btn.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            }
            
            resetNavTimer();
        }

        // ============ INITIALIZATION ============
        window.addEventListener('DOMContentLoaded', () => {
            // Load theme
            const savedTheme = localStorage.getItem('theme');
            const themeBtn = document.getElementById('themeToggle');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                if (themeBtn) themeBtn.textContent = '‚òÄÔ∏è';
            }

            // Load saved voice preference
            const savedVoice = localStorage.getItem('preferredVoice');
            const voiceSelector = document.getElementById('voiceSelector');
            if (savedVoice && voiceSelector) {
                voiceSelector.value = savedVoice;
                const voiceIndex = TTS_CONFIG.VOICE_VARIATIONS.findIndex(v => v.name === savedVoice);
                if (voiceIndex !== -1) {
                    selectedVoiceIndex = voiceIndex;
                }
            }

            // Start auto-hide timer
            resetNavTimer();

            // Show random welcome message
            const randomIndex = Math.floor(Math.random() * welcomeMessages.length);
            const welcomeMsg = welcomeMessages[randomIndex];
            const welcomeText = document.getElementById('welcomeText');
            if (welcomeText) welcomeText.textContent = welcomeMsg;

            // Auto-play welcome message
            speakText(welcomeMsg);

            // Auto-hide welcome after 8 seconds
            setTimeout(() => skipIntro(), 8000);
        });

        function skipIntro() {
            stopSpeech();
            const welcomeScreen = document.getElementById('welcomeScreen');
            const mainSelection = document.getElementById('mainSelection');
            
            if (welcomeScreen) welcomeScreen.classList.add('hidden');
            if (mainSelection) mainSelection.classList.add('active');
        }

        function toggleTheme() {
            const html = document.documentElement;
            const btn = document.querySelector('.theme-toggle');
            
            if (html.getAttribute('data-theme') === 'dark') {
                html.removeAttribute('data-theme');
                btn.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                btn.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            }
        }

        function startSection(section) {
            currentSection = section;
            currentScriptIndex = 0;
            
            document.getElementById('mainSelection').classList.remove('active');
            document.getElementById('scriptDisplay').classList.add('active');
            
            loadScript();
        }

        function loadScript() {
            if (!currentSection) return;
            
            const scripts = scriptsDatabase[currentSection];
            const script = scripts[currentScriptIndex];
            
            if (!script) return;
            
            // Update display
            document.getElementById('scriptContent').textContent = script.content;
            document.getElementById('progressIndicator').textContent = 
                `${currentScriptIndex + 1} / ${scripts.length}`;
            
            // Update favorite button
            updateFavoriteButton();
            
            // Track
            trackScriptPlay(script.id, currentSection);
            
            // Auto-play
            stopSpeech();
            setTimeout(() => speakText(script.content), 500);
        }

        function nextScript() {
            const scripts = scriptsDatabase[currentSection];
            if (currentScriptIndex < scripts.length - 1) {
                currentScriptIndex++;
                loadScript();
            }
        }

        function previousScript() {
            if (currentScriptIndex > 0) {
                currentScriptIndex--;
                loadScript();
            }
        }

        function closeScript() {
            stopSpeech();
            document.getElementById('scriptDisplay').classList.remove('active');
            document.getElementById('mainSelection').classList.add('active');
            currentSection = null;
            currentScriptIndex = 0;
        }

        function togglePlay() {
            if (isPlaying) {
                if (currentAudio) {
                    currentAudio.pause();
                } else {
                    window.speechSynthesis.pause();
                }
                isPlaying = false;
                document.getElementById('playBtn').innerHTML = '‚ñ∂';
            } else {
                if (currentAudio) {
                    currentAudio.play();
                } else {
                    window.speechSynthesis.resume();
                }
                isPlaying = true;
                document.getElementById('playBtn').innerHTML = '‚è∏';
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('scriptDisplay').classList.contains('active')) {
                switch(e.key) {
                    case ' ':
                        e.preventDefault();
                        togglePlay();
                        break;
                    case 'ArrowRight':
                        nextScript();
                        break;
                    case 'ArrowLeft':
                        previousScript();
                        break;
                    case 'Escape':
                        closeScript();
                        break;
                    case 'f':
                    case 'F':
                        toggleFavorite();
                        break;
                }
            }
        });
    </script>
</body>
</html>