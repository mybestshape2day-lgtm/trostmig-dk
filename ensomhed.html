<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrøstMig.dk - Video Baggrund Player</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-overflow-scrolling: touch;
        }

        :root {
            --text-primary: rgba(255, 255, 255, 0.95);
            --text-secondary: rgba(255, 255, 255, 0.7);
            --bg-overlay: rgba(0, 0, 0, 0.4);
            --accent: #7c3aed;
            --success: #10b981;
            --warning: #f59e0b;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }

        /* VIDEO BACKGROUND SYSTEM */
        .video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
        }

        .video-background video {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            transform: translate(-50%, -50%);
            object-fit: cover;
            opacity: 0.6;
            transition: opacity 2s ease;
            /* Mobile optimization */
            will-change: transform;
            transform: translate3d(-50%, -50%, 0);
        }

        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, 
                rgba(30, 58, 138, 0.3) 0%,
                rgba(79, 70, 229, 0.2) 50%,
                rgba(124, 58, 237, 0.3) 100%);
            backdrop-filter: blur(1px);
        }

        /* FOG OVERLAY ANIMATION */
        .fog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 120%;
            height: 120%;
            z-index: -1;
            opacity: 0.3;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            animation: fogDrift 20s ease-in-out infinite alternate;
        }

        @keyframes fogDrift {
            0% { transform: translate(0%, 0%) rotate(0deg); }
            100% { transform: translate(-10%, -5%) rotate(2deg); }
        }

        /* MOBILE SCROLL FIX */
        .main-container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            background: transparent;
            /* iOS viewport fix */
            min-height: 100dvh;
            overflow-y: auto;
            overscroll-behavior: contain;
        }

        /* HEADER */
        .header {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .voice-selector {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--text-primary); /* Hvid tekst */
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        /* Dropdown options styling */
        .voice-selector option {
            background: rgba(0, 0, 0, 0.9); /* Mørk baggrund */
            color: white; /* Hvid tekst på optioner */
            padding: 8px;
        }

        .favorites-counter {
            background: var(--success);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* SCRIPT SELECTION */
        .script-section {
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 40px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .script-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
        }

        .script-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .script-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s;
        }

        .script-card:hover::before {
            left: 100%;
        }

        .script-card:hover {
            transform: translateY(-8px);
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .script-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .favorite-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.6;
            position: relative;
        }

        .favorite-btn:hover,
        .favorite-btn.active {
            opacity: 1;
            transform: scale(1.2);
            filter: drop-shadow(0 0 8px #fbbf24);
        }

        .script-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .script-description {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .script-duration {
            background: rgba(124, 58, 237, 0.3);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        /* PLAYER INTERFACE */
        .player-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            flex-direction: column;
        }

        .player-modal.active {
            display: flex;
            animation: fadeIn 0.5s ease;
        }

        .player-header {
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .close-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: #fca5a5;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(239, 68, 68, 0.4);
        }

        .player-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .text-display {
            max-width: 800px;
            font-size: 1.6rem;
            line-height: 2;
            text-align: center;
            position: relative;
        }

        .typing-text {
            border-right: 3px solid var(--accent);
            animation: cursor-blink 1s step-end infinite;
        }

        @keyframes cursor-blink {
            0%, 50% { border-color: var(--accent); }
            51%, 100% { border-color: transparent; }
        }

        .player-controls {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(124, 58, 237, 0.5);
        }

        .control-btn.primary {
            width: 80px;
            height: 80px;
            background: var(--accent);
            border-color: var(--accent);
        }

        .control-btn.primary:hover {
            background: #6d28d9;
        }

        /* FAVORITES PANEL */
        .favorites-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            z-index: 2000;
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }

        .favorites-panel.open {
            right: 0;
        }

        .favorites-header {
            padding: 20px;
            background: rgba(124, 58, 237, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .favorites-list {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .favorite-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .favorite-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-5px);
        }

        .favorite-info h4 {
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .favorite-info p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .remove-favorite {
            color: #ef4444;
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }

        .remove-favorite:hover {
            opacity: 1;
        }

        /* MOBILE RESPONSIVE */
        @media (max-width: 768px) {
            .favorites-panel {
                width: 100%;
                right: -100%;
            }

            .script-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .text-display {
                font-size: 1.3rem;
                padding: 20px;
            }

            .section-title {
                font-size: 2rem;
            }
        }

        /* Loading and animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Video Background -->
    <div class="video-background">
        <video autoplay muted loop playsinline id="bgVideo">
            <source src="https://cdn.midjourney.com/video/1b3f6c67-fbfd-47fd-8540-e96adad0376e/0.mp4" type="video/mp4">
            <!-- Skift URL ovenfor til din egen video -->
            <!-- Eksempel andre videoer:
            <source src="https://cdn.midjourney.com/video/1b3f6c67-fbfd-47fd-8540-e96adad0376e/0.mp4" type="video/mp4">
            <source src="/videos/taaet-landskab.mp4" type="video/mp4">
            -->
        </video>
    </div>
    
    <div class="video-overlay"></div>
    <div class="fog-overlay"></div>

    <div class="main-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">🎵 TrøstMig.dk</div>
                <div class="controls">
                    <select class="voice-selector" id="voiceSelector">
                        <option value="da-DK-Chirp3-HD-Sulafat">Anna - Varm kvinde</option>
                        <option value="da-DK-Chirp3-HD-Charon">Simon - Rolig mand</option>
                        <option value="da-DK-Chirp3-HD-Vindemiatrix">Maria - Rolig kvinde</option>
                        <option value="da-DK-Chirp3-HD-Erriapus">Sofie - Blød kvinde</option>
                    </select>
                    <button onclick="toggleFavorites()" class="favorites-counter" id="favoritesBtn">
                        ⭐ <span id="favoritesCount">0</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="script-section">
            <h1 class="section-title">Ensomhed Scripts</h1>
            
            <div class="script-grid">
                <div class="script-card" data-script="akut-ensomhed" onclick="playScript('akut-ensomhed')">
                    <div class="card-header">
                        <div>
                            <div class="script-icon">🆘</div>
                            <h3 class="script-title">Stop ensomhedsspiralen</h3>
                        </div>
                        <button class="favorite-btn" onclick="toggleFavorite(event, 'akut-ensomhed')">⭐</button>
                    </div>
                    <p class="script-description">Du lytter til dette fordi ensomheden føles overvældende lige nu. Lad os bruge 5-4-3-2-1 grounding til at bringe dig tilbage.</p>
                    <span class="script-duration">4-6 min</span>
                </div>

                <div class="script-card" data-script="forstaa-ensomhed" onclick="playScript('forstaa-ensomhed')">
                    <div class="card-header">
                        <div>
                            <div class="script-icon">🧠</div>
                            <h3 class="script-title">Ensomhedens neurobiologi</h3>
                        </div>
                        <button class="favorite-btn" onclick="toggleFavorite(event, 'forstaa-ensomhed')">⭐</button>
                    </div>
                    <p class="script-description">Ensomhed er et biologisk alarmsystem. Her er hvad der sker i din hjerne, og hvorfor du ikke skal skamme dig.</p>
                    <span class="script-duration">8-10 min</span>
                </div>

                <div class="script-card" data-script="haandter-ensomhed" onclick="playScript('haandter-ensomhed')">
                    <div class="card-header">
                        <div>
                            <div class="script-icon">🎯</div>
                            <h3 class="script-title">Mikro-forbindelser</h3>
                        </div>
                        <button class="favorite-btn" onclick="toggleFavorite(event, 'haandter-ensomhed')">⭐</button>
                    </div>
                    <p class="script-description">Du behøver ikke en bedste ven i morgen. Start med små, gentagne sociale udvekslinger der virker.</p>
                    <span class="script-duration">6-8 min</span>
                </div>

                <div class="script-card" data-script="nattens-ensomhed" onclick="playScript('nattens-ensomhed')">
                    <div class="card-header">
                        <div>
                            <div class="script-icon">🌙</div>
                            <h3 class="script-title">Når natten er værst</h3>
                        </div>
                        <button class="favorite-btn" onclick="toggleFavorite(event, 'nattens-ensomhed')">⭐</button>
                    </div>
                    <p class="script-description">Natlig ensomhed aktiverer samme hjerneområder som fysisk smerte. Lad os dæmpe alarmen sammen.</p>
                    <span class="script-duration">5-7 min</span>
                </div>
            </div>
        </main>
    </div>

    <!-- Player Modal -->
    <div class="player-modal" id="playerModal">
        <div class="player-header">
            <h2 class="player-title" id="playerTitle">Loading...</h2>
            <button class="close-btn" onclick="closePlayer()">✕ Luk</button>
        </div>
        
        <div class="player-content">
            <div class="text-display" id="textDisplay">
                Forbereder audio...
            </div>
        </div>
        
        <div class="player-controls">
            <button class="control-btn" onclick="previousSentence()">⏮</button>
            <button class="control-btn primary" onclick="togglePlayback()" id="playButton">▶</button>
            <button class="control-btn" onclick="nextSentence()">⏭</button>
            <button class="control-btn" onclick="stopPlayback()">⏹</button>
        </div>
    </div>

    <!-- Favorites Panel -->
    <div class="favorites-panel" id="favoritesPanel">
        <div class="favorites-header">
            <h3>Mine Favoritter</h3>
            <button class="close-btn" onclick="toggleFavorites()" style="float: right;">✕</button>
        </div>
        <div class="favorites-list" id="favoritesList">
            <p style="text-align: center; color: var(--text-secondary); margin-top: 50px;">
                Ingen favoritter endnu.<br>Tryk ⭐ på scripts for at gemme dem.
            </p>
        </div>
    </div>

    <script>
        // ========== SCRIPT DATABASE ==========
        const scriptsDatabase = {
            'akut-ensomhed': {
                title: 'Stop ensomhedsspiralen',
                sentences: [
                    "Du lytter til dette fordi du har brug for hjælp lige nu.",
                    "Ensomheden føles måske som en tung sten i brystet.",
                    "Vi skal bruge grounding. Fem-fire-tre-to-et teknikken.",
                    "Find fem ting du kan se omkring dig. Tag din tid.",
                    "Nu fire ting du kan røre ved. Mærk teksturen.",
                    "Tre lyde du kan høre lige nu. Lyt virkelig.",
                    "To ting du kan lugte. Eller forestil dig to dufte.",
                    "Og endelig. Én ting du kan smage.",
                    "Mærk efter nu. Er ensomheden stadig lige så overvældende?",
                    "Du aktiverede dit rolighedssystem. Du fortalte din hjerne: Jeg er tryg.",
                    "Denne øvelse kan du altid bruge. Hvor som helst."
                ]
            },
            'forstaa-ensomhed': {
                title: 'Ensomhedens neurobiologi',
                sentences: [
                    "Ensomhed er ikke bare en følelse. Det er et biologisk alarmsystem.",
                    "Din anterior cingulate cortex aktiveres. Det samme område som ved fysisk smerte.",
                    "Det forklarer hvorfor ensomhed kan gøre ondt. Bogstaveligt talt.",
                    "Din amygdala, dit frygtcenter, går i overdrive.",
                    "Social isolation blev tolket som livsfarligt af vores forfædre.",
                    "Så din hjerne skriger: Fare! Find stammen!",
                    "Samtidig falder produktionen af oxytocin. Dit bonding-hormon.",
                    "Uden oxytocin stiger kortisol. Dit stresshormon.",
                    "Men ved at forstå dette kan vi stoppe med at skamme os.",
                    "Der er ikke noget galt med dig. Din hjerne beskytter dig.",
                    "Og hvis det er biologi, kan det også påvirkes.",
                    "Din hjerne er plastisk. Den kan lære igen."
                ]
            },
            'haandter-ensomhed': {
                title: 'Mikro-forbindelser',
                sentences: [
                    "Du behøver ikke en bedste ven i morgen for at bekæmpe ensomhed.",
                    "Start med mikro-forbindelser. Små, gentagne sociale udvekslinger.",
                    "Selv fem minutters small talk kan forbedre humør og reducere ensomhed.",
                    "Sig godmorgen til buschaufføren. Smile til baristaen.",
                    "To minutters samtale med kassemedarbejderen.",
                    "Det lyder måske ubetydelig. Men forskningen er klar: Det virker.",
                    "Vælg tre steder du kommer regelmæssigt.",
                    "Vær konsistent. Gå de samme steder. Samme tid hvis muligt.",
                    "Start småt. Bare et hej. Et smil.",
                    "Det tager cirka elleve interaktioner før folk føler genkendelighed.",
                    "Men når det sker, starter noget smukt.",
                    "Du bliver en del af deres rutine. De bliver en del af din.",
                    "Mikro-forbindelser over tid bygger makro-tilhørsforhold."
                ]
            },
            'nattens-ensomhed': {
                title: 'Når natten er værst',
                sentences: [
                    "Natten kan forstærke ensomheden. Når alle andre sover.",
                    "Når mørket lukker sig om dig. Og tankerne bliver højere.",
                    "Du lytter til dette om natten. Jeg ved du kæmper.",
                    "Så lad mig sige det: Det er okay at være vågen. Det er okay at kæmpe.",
                    "Natlig ensomhed aktiverer de samme hjerneområder som fysisk smerte.",
                    "Dit nervesystem er i højeste alarmberedskab. Det er ikke din skyld.",
                    "Men vi kan dæmpe alarmen. Sammen.",
                    "Først. Lys. Tænd et blidt lys. Ikke det skarpe loftlys.",
                    "Lyset fortæller din hjerne: Det er okay. Vi er trygge.",
                    "Nu. Varme. Lav en kop te hvis du kan. Pak dig ind i et tæppe.",
                    "Varme aktiverer dit comfort-system. De samme receptorer fra da du var barn.",
                    "Husk: Natten slutter. Lyset kommer altid tilbage.",
                    "Lige nu er der tusinder af andre der også er vågne. Du er omgivet af usynlige kammerater."
                ]
            }
        };

        // ========== TTS SYSTEM ==========
        class TTSEngine {
            constructor() {
                this.apiKey = 'AIzaSyCKQO9FZXRtRtv6k_XymPXHJHp7hrvjEqk';
                this.currentVoice = 'da-DK-Chirp3-HD-Sulafat';
                this.currentAudio = null;
                this.audioCache = new Map();
            }

            async generateTTS(text) {
                const cacheKey = `${text}-${this.currentVoice}`;
                if (this.audioCache.has(cacheKey)) {
                    return this.audioCache.get(cacheKey);
                }

                try {
                    const response = await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${this.apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            input: { text: text },
                            voice: {
                                languageCode: 'da-DK',
                                name: this.currentVoice,
                                ssmlGender: this.currentVoice.includes('Sulafat') ? 'FEMALE' : 'MALE'
                            },
                            audioConfig: {
                                audioEncoding: 'MP3',
                                speakingRate: 0.9
                            }
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        this.audioCache.set(cacheKey, data.audioContent);
                        return data.audioContent;
                    }
                } catch (error) {
                    console.error('TTS Error:', error);
                }
                return null;
            }

            async playAudio(base64Audio) {
                if (this.currentAudio) {
                    this.currentAudio.pause();
                }

                return new Promise((resolve, reject) => {
                    const audio = new Audio(`data:audio/mp3;base64,${base64Audio}`);
                    this.currentAudio = audio;
                    
                    audio.onended = resolve;
                    audio.onerror = reject;
                    audio.play();
                });
            }

            stop() {
                if (this.currentAudio) {
                    this.currentAudio.pause();
                    this.currentAudio = null;
                }
            }
        }

        // ========== FAVORITES SYSTEM ==========
        class FavoritesManager {
            constructor() {
                this.favorites = JSON.parse(localStorage.getItem('trostmig_favorites') || '[]');
                this.updateUI();
            }

            add(scriptId) {
                if (!this.favorites.includes(scriptId)) {
                    this.favorites.push(scriptId);
                    this.save();
                    this.updateUI();
                    return true;
                }
                return false;
            }

            remove(scriptId) {
                const index = this.favorites.indexOf(scriptId);
                if (index > -1) {
                    this.favorites.splice(index, 1);
                    this.save();
                    this.updateUI();
                    return true;
                }
                return false;
            }

            has(scriptId) {
                return this.favorites.includes(scriptId);
            }

            save() {
                localStorage.setItem('trostmig_favorites', JSON.stringify(this.favorites));
            }

            updateUI() {
                // Update counter
                document.getElementById('favoritesCount').textContent = this.favorites.length;
                
                // Update favorite buttons
                document.querySelectorAll('.favorite-btn').forEach(btn => {
                    const card = btn.closest('.script-card');
                    const scriptId = card?.dataset.script;
                    if (scriptId) {
                        btn.classList.toggle('active', this.has(scriptId));
                    }
                });

                // Update favorites panel
                this.updateFavoritesPanel();
            }

            updateFavoritesPanel() {
                const favoritesList = document.getElementById('favoritesList');
                
                if (this.favorites.length === 0) {
                    favoritesList.innerHTML = `
                        <p style="text-align: center; color: var(--text-secondary); margin-top: 50px;">
                            Ingen favoritter endnu.<br>Tryk ⭐ på scripts for at gemme dem.
                        </p>
                    `;
                    return;
                }

                favoritesList.innerHTML = this.favorites.map(scriptId => {
                    const script = scriptsDatabase[scriptId];
                    if (!script) return '';
                    
                    return `
                        <div class="favorite-item" onclick="playScript('${scriptId}')">
                            <div class="favorite-info">
                                <h4>${script.title}</h4>
                                <p>${script.sentences.length} afsnit</p>
                            </div>
                            <span class="remove-favorite" onclick="removeFavorite(event, '${scriptId}')">×</span>
                        </div>
                    `;
                }).join('');
            }
        }

        // ========== SCRIPT PLAYER ==========
        class ScriptPlayer {
            constructor() {
                this.tts = new TTSEngine();
                this.currentScript = null;
                this.currentSentence = 0;
                this.isPlaying = false;
            }

            async playScript(scriptId) {
                this.currentScript = scriptsDatabase[scriptId];
                if (!this.currentScript) return;

                this.currentSentence = 0;
                
                // Show player
                document.getElementById('playerModal').classList.add('active');
                document.getElementById('playerTitle').textContent = this.currentScript.title;
                
                // Start playing
                await this.playSentence();
            }

            async playSentence() {
                if (!this.currentScript || this.currentSentence >= this.currentScript.sentences.length) {
                    this.isPlaying = false;
                    document.getElementById('playButton').textContent = '▶';
                    return;
                }

                const sentence = this.currentScript.sentences[this.currentSentence];
                
                // Show typing animation
                await this.typeText(sentence);
                
                // Generate and play TTS
                const audioContent = await this.tts.generateTTS(sentence);
                if (audioContent) {
                    this.isPlaying = true;
                    document.getElementById('playButton').textContent = '⏸';
                    
                    try {
                        await this.tts.playAudio(audioContent);
                        
                        // Auto advance
                        if (this.isPlaying) {
                            setTimeout(() => {
                                this.currentSentence++;
                                this.playSentence();
                            }, 1500);
                        }
                    } catch (error) {
                        console.error('Playback error:', error);
                        this.isPlaying = false;
                        document.getElementById('playButton').textContent = '▶';
                    }
                }
            }

            async typeText(text) {
                const textDisplay = document.getElementById('textDisplay');
                textDisplay.innerHTML = '';
                textDisplay.classList.add('typing-text');

                for (let i = 0; i <= text.length; i++) {
                    textDisplay.textContent = text.slice(0, i);
                    await new Promise(resolve => setTimeout(resolve, 30));
                }

                setTimeout(() => {
                    textDisplay.classList.remove('typing-text');
                }, 1000);
            }

            togglePlayback() {
                if (this.isPlaying) {
                    this.tts.stop();
                    this.isPlaying = false;
                    document.getElementById('playButton').textContent = '▶';
                } else {
                    this.playSentence();
                }
            }

            previousSentence() {
                if (this.currentSentence > 0) {
                    this.currentSentence--;
                    this.tts.stop();
                    this.playSentence();
                }
            }

            nextSentence() {
                if (this.currentSentence < this.currentScript.sentences.length - 1) {
                    this.currentSentence++;
                    this.tts.stop();
                    this.playSentence();
                }
            }

            stop() {
                this.tts.stop();
                this.isPlaying = false;
                document.getElementById('playButton').textContent = '▶';
            }

            close() {
                this.stop();
                document.getElementById('playerModal').classList.remove('active');
            }
        }

        // ========== GLOBAL INSTANCES ==========
        const favoritesManager = new FavoritesManager();
        const scriptPlayer = new ScriptPlayer();

        // ========== GLOBAL FUNCTIONS ==========
        function toggleFavorite(event, scriptId) {
            event.stopPropagation();
            
            if (favoritesManager.has(scriptId)) {
                favoritesManager.remove(scriptId);
            } else {
                favoritesManager.add(scriptId);
            }
        }

        function removeFavorite(event, scriptId) {
            event.stopPropagation();
            favoritesManager.remove(scriptId);
        }

        function toggleFavorites() {
            const panel = document.getElementById('favoritesPanel');
            panel.classList.toggle('open');
        }

        function playScript(scriptId) {
            scriptPlayer.playScript(scriptId);
        }

        function togglePlayback() {
            scriptPlayer.togglePlayback();
        }

        function previousSentence() {
            scriptPlayer.previousSentence();
        }

        function nextSentence() {
            scriptPlayer.nextSentence();
        }

        function stopPlayback() {
            scriptPlayer.stop();
        }

        function closePlayer() {
            scriptPlayer.close();
        }

        // Voice selector
        document.getElementById('voiceSelector').addEventListener('change', (e) => {
            scriptPlayer.tts.currentVoice = e.target.value;
            console.log('Voice changed to:', e.target.value);
        });

        // Video background error handling
        document.getElementById('bgVideo').addEventListener('error', function() {
            console.log('Video failed to load, using CSS fallback');
            document.querySelector('.video-background').style.background = 
                'linear-gradient(45deg, #1e3a8a, #3730a3, #7c2d12)';
        });

        console.log('🎵 Video Background Player with Favorites System loaded');
    </script>
</body>
</html>