<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Selvskade - Interaktiv Session</title>
  <style>
    html, body { margin: 0; padding: 0; width: 100vw; height: 100vh; background: #000; overflow: hidden; }
    body { font-family: 'Segoe UI', Arial, sans-serif; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
    .start-screen { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #fff; color: #222; z-index: 10; }
    .start-btn { font-size: 2rem; padding: 2rem 4rem; border-radius: 2rem; border: none; background: #fff; box-shadow: 0 2px 16px rgba(0,0,0,0.08); cursor: pointer; margin-top: 2rem; }
    .countdown { font-size: 3rem; margin-bottom: 2rem; color: #222; }
    .fullscreen-video { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: 1; background: #fff; }
    .overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.25); z-index: 2; pointer-events: none; }
    .script-text { position: fixed; bottom: 14vh; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.90); color: #222; border-radius: 1.5rem; padding: 2rem 2.5rem; font-size: 1.3rem; font-weight: 500; text-align: center; max-width: 90vw; min-width: 320px; z-index: 3; box-shadow: 0 4px 32px rgba(0,0,0,0.10); transition: background 0.3s; }
    .choices { margin-top: 2rem; display: flex; gap: 1.5rem; justify-content: center; }
    .choice-btn { background: #fff; color: #222; border: none; border-radius: 1.2rem; padding: 1rem 2rem; font-size: 1.1rem; font-weight: 500; cursor: pointer; box-shadow: 0 2px 12px rgba(0,0,0,0.10); transition: background 0.2s; }
    .choice-btn:hover { background: #ececec; }
    .player-controls { position: fixed; bottom: 4vh; left: 50%; transform: translateX(-50%); display: flex; gap: 2rem; z-index: 4; }
    .player-btn { background: #fff; color: #222; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 2rem; cursor: pointer; box-shadow: 0 2px 12px rgba(0,0,0,0.10); transition: background 0.2s; }
    .player-btn.active { color: #e74c3c; }
    .voice-selector { min-width:160px; max-width:220px; font-size:1rem; padding:8px 12px; border-radius:12px; background:#fff; color:#222; border:1px solid #eee; outline:none; box-shadow:0 2px 8px rgba(0,0,0,0.04); }
    @media (max-width: 600px) { .script-text { font-size: 1.05rem; padding: 1.2rem 1rem; } .player-btn { width: 44px; height: 44px; font-size: 1.3rem; } }
  </style>
</head>
<body>
  <nav class="nav-header" id="mainNav">
    <div class="nav-content">
      <a href="index.html" class="nav-logo">TrøstMig.dk</a>
      <div class="nav-links">
        <a href="login.html" class="nav-link primary">Log ind</a>
        <a href="index.html" class="nav-link">Hovedmenu</a>
        <a href="Dashboard.html" class="nav-link">Dashboard</a>
        <a href="playlists.html" class="nav-link">Playlister</a>
      </div>
      <div class="nav-user" style="display:none;"></div>
    </div>
  </nav>
  <div class="nav-show-indicator" id="navIndicator">Ryk mus for at vise menu</div>

  <div class="start-screen" id="startScreen">
    <h1>Selvskade</h1>
    <div style="margin-top:2rem;">
      <button class="start-btn" id="startBtn">Start</button>
    </div>
  </div>
  <video class="fullscreen-video" id="bgVideo" src="din-video.mp4" preload="auto" muted></video>
  <div class="overlay"></div>
  <div class="script-text" id="scriptText" style="display:none;"></div>
  <div class="player-controls" id="playerControls" style="display:none;">
    <button class="player-btn" id="stopBtn" title="Stop">⏹️</button>
    <button class="player-btn" id="pauseBtn" title="Pause">⏸️</button>
    <button class="player-btn" id="favBtn" title="Favorit">⭐</button>
    <select class="voice-selector" id="voiceSelector">
      <option value="da-DK-Chirp3-HD-Charon">Simon - Mand, rolig</option>
      <option value="da-DK-Chirp3-HD-Sulafat">Anna - Kvinde, varm</option>
      <option value="da-DK-Chirp3-HD-Vindemiatrix">Maria - Kvinde, rolig</option>
      <option value="da-DK-Chirp3-HD-Erriapus">Sofie - Kvinde, blød</option>
      <option value="da-DK-Chirp3-HD-Enceladus">Lars - Mand, naturlig</option>
      <option value="da-DK-Chirp3-HD-Rasalgethi">Mikkel - Mand, neutral</option>
      <option value="da-DK-Chirp3-HD-Sadachbia">Peter - Mand, rolig</option>
      <option value="da-DK-Chirp3-HD-Schedar">Thomas - Mand, klassisk</option>
      <option value="da-DK-Chirp3-HD-Callirrhoe">Line - Kvinde, klar</option>
      <option value="da-DK-Chirp3-HD-Despina">Camilla - Kvinde, lys</option>
      <option value="da-DK-Chirp3-HD-Umbriel">Henrik - Mand, kraftfuld</option>
      <option value="da-DK-Chirp3-HD-Sadaltager">Morten - Mand, seriøs</option>
      <option value="da-DK-Chirp3-HD-Zephyr">Emma - Kvinde, let</option>
    </select>
  </div>
  <audio id="audioTrack" src="audio1.mp3" preload="auto"></audio>
  <script src="tts-config.js"></script>
  <script>
    // --- Modulært script med valg ---
    const modules = [
      {
        id: 'intro',
        text: "Velkommen. Du er ikke alene – mange oplever selvskade, og det kan forandre sig. I dag vil jeg guide dig gennem viden, øvelser og refleksioner, der kan hjælpe. Du kan til enhver tid stoppe eller tage en pause.",
        next: 'valg1'
      },
      {
        id: 'valg1',
        text: "Hvad vil du gerne starte med?",
        choices: [
          { label: "Hør om hvorfor selvskade opstår", next: 'psykoedukation' },
          { label: "Få strategier til at håndtere trangen", next: 'strategier' },
          { label: "Tag hele rejsen", next: 'psykoedukation' }
        ]
      },
      {
        id: 'psykoedukation',
        text: "Selvskade er ofte en måde at håndtere svære følelser på. Det kan give en midlertidig lettelse, men løser ikke det bagvedliggende problem. Forskning viser, at der findes andre, mere hjælpsomme strategier.",
        next: 'refleksion'
      },
      {
        id: 'strategier',
        text: "Når trangen opstår, kan du prøve at aflede dig selv: Hold is i hånden, skriv dine tanker ned, eller ring til en ven. Mindfulness og vejrtrækning kan også hjælpe.",
        next: 'refleksion'
      },
      {
        id: 'refleksion',
        text: "Hvilken situation genkender du mest?",
        choices: [
          { label: "Når jeg føler mig overvældet", next: 'overvaeldet' },
          { label: "Når jeg føler mig tom/uden følelser", next: 'tomhed' },
          { label: "Når jeg føler skyld/skam", next: 'skyld' }
        ]
      },
      {
        id: 'overvaeldet',
        text: "Når du er overvældet, kan det hjælpe at sætte ord på følelsen. Prøv at skrive ned, hvad der sker i dig lige nu. Husk, følelser er som bølger – de vokser, men de aftager også igen.",
        next: 'motivation'
      },
      {
        id: 'tomhed',
        text: "Følelsen af tomhed kan være svær. Prøv at lave noget sanseligt: Lyt til musik, tag et varmt bad, eller gå en tur. Det kan hjælpe dig tilbage i kroppen.",
        next: 'motivation'
      },
      {
        id: 'skyld',
        text: "Skyld og skam er tunge følelser. Husk: Du er ikke forkert, og du fortjener omsorg. Prøv at tale til dig selv, som du ville tale til en ven.",
        next: 'motivation'
      },
      {
        id: 'motivation',
        text: "Forskning viser, at mennesker der øver nye strategier, får det bedre over tid. Små skridt tæller. Hver gang du vælger omsorg frem for selvskade, styrker du din hjerne.",
        next: 'afslutning'
      },
      {
        id: 'afslutning',
        text: "Du er i gang med en proces. Hver gang du øver, skaber du nye forbindelser i hjernen. Vil du prøve en lille øvelse, hvor du skriver eller siger højt, hvad du ville gøre, hvis trangen kom igen? Tak fordi du tog dig tid til dig selv.",
        next: null
      }
    ];
    let currentModule = modules[0];
    let isPaused = false;
    let ttsUtterance = null;
    let ttsActive = false;
    let moduleTimeout = null;
    const startScreen = document.getElementById('startScreen');
    const startBtn = document.getElementById('startBtn');
    const bgVideo = document.getElementById('bgVideo');
    const scriptText = document.getElementById('scriptText');
    const playerControls = document.getElementById('playerControls');
    const stopBtn = document.getElementById('stopBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const favBtn = document.getElementById('favBtn');
    const audioTrack = document.getElementById('audioTrack');
    const voiceSelector = document.getElementById('voiceSelector');

    // --- Favorit system (fælles localStorage) ---
    function getFavorites() {
      return JSON.parse(localStorage.getItem('trostmig_favorites') || '[]');
    }
    function setFavorite(id) {
      let favs = getFavorites();
      if (!favs.includes(id)) favs.push(id);
      localStorage.setItem('trostmig_favorites', JSON.stringify(favs));
      favBtn.classList.add('active');
    }
    function removeFavorite(id) {
      let favs = getFavorites();
      favs = favs.filter(f => f !== id);
      localStorage.setItem('trostmig_favorites', JSON.stringify(favs));
      favBtn.classList.remove('active');
    }
    function updateFavBtn() {
      const favs = getFavorites();
      favBtn.classList.toggle('active', favs.includes('selvskade'));
    }
    favBtn.onclick = () => {
      const favs = getFavorites();
      if (favs.includes('selvskade')) removeFavorite('selvskade');
      else setFavorite('selvskade');
    };

    // --- Fuldskærm og start flow ---
    startBtn.onclick = async () => {
      if (document.documentElement.requestFullscreen) {
        try { await document.documentElement.requestFullscreen(); } catch(e){}
      }
      startScreen.style.display = 'none';
      countdownAndStart();
    };
    function countdownAndStart() {
      const cd = document.createElement('div');
      cd.className = 'countdown';
      cd.textContent = '3';
      startScreen.parentNode.appendChild(cd);
      let count = 3;
      const interval = setInterval(() => {
        count--;
        if (count > 0) cd.textContent = count;
        else {
          clearInterval(interval);
          cd.remove();
          startPlayer();
        }
      }, 1000);
    }

    // --- Player logic ---
    function startPlayer() {
      bgVideo.currentTime = 0;
      audioTrack.currentTime = 0;
      bgVideo.play();
      audioTrack.play();
      scriptText.style.display = 'block';
      playerControls.style.display = 'flex';
      showModule(modules[0]);
      updateFavBtn();
    }
    function showModule(module) {
      currentModule = module;
      scriptText.innerHTML = module.text;
      playTTS(module.text);
      // Choices
      if (module.choices) {
        const choicesDiv = document.createElement('div');
        choicesDiv.className = 'choices';
        module.choices.forEach(choice => {
          const btn = document.createElement('button');
          btn.className = 'choice-btn';
          btn.textContent = choice.label;
          btn.onclick = (e) => {
            e.stopPropagation();
            showModule(modules.find(m => m.id === choice.next));
          };
          choicesDiv.appendChild(btn);
        });
        scriptText.appendChild(choicesDiv);
      } else if (module.next) {
        // Auto-advance hvis ikke paused
        if (moduleTimeout) clearTimeout(moduleTimeout);
        if (!isPaused) {
          moduleTimeout = setTimeout(() => {
            if (!isPaused) showModule(modules.find(m => m.id === module.next));
          }, 8000);
        }
      }
    }
    function playTTS(text) {
      stopTTS();
      ttsUtterance = new SpeechSynthesisUtterance(text);
      ttsUtterance.lang = 'da-DK';
      ttsUtterance.voice = Array.from(window.speechSynthesis.getVoices()).find(v => v.name === voiceSelector.value) || null;
      ttsActive = true;
      window.speechSynthesis.speak(ttsUtterance);
      ttsUtterance.onend = () => { ttsActive = false; };
    }
    function stopTTS() {
      window.speechSynthesis.cancel();
      ttsUtterance = null;
      ttsActive = false;
    }

    // --- Controls ---
    stopBtn.onclick = () => {
      stopAll();
      if (document.fullscreenElement) document.exitFullscreen();
      startScreen.style.display = 'flex';
      scriptText.style.display = 'none';
      playerControls.style.display = 'none';
    };
    pauseBtn.onclick = () => {
      if (!isPaused) {
        bgVideo.pause();
        audioTrack.pause();
        window.speechSynthesis.pause();
        pauseBtn.textContent = '▶️';
        isPaused = true;
        if (moduleTimeout) clearTimeout(moduleTimeout);
      } else {
        bgVideo.play();
        audioTrack.play();
        window.speechSynthesis.resume();
        pauseBtn.textContent = '⏸️';
        isPaused = false;
        if (currentModule.next) showModule(currentModule);
      }
    };
    voiceSelector.onchange = () => {
      localStorage.setItem('preferredVoice', voiceSelector.value);
      playTTS(currentModule.text);
    };

    // --- Stop alt hvis man forlader siden/emnet ---
    function stopAll() {
      bgVideo.pause();
      audioTrack.pause();
      stopTTS();
      isPaused = false;
      if (moduleTimeout) clearTimeout(moduleTimeout);
      pauseBtn.textContent = '⏸️';
    }
    window.addEventListener('beforeunload', stopAll);
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) stopAll();
    });

    // --- Favorit-knap init og stemmevalg init ---
    document.addEventListener('DOMContentLoaded', function() {
      const savedVoice = localStorage.getItem('preferredVoice');
      if (savedVoice) voiceSelector.value = savedVoice;
      updateFavBtn();
    });
  </script>
</body>
</html>
