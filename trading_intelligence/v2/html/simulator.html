<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Simulator - Paper Trading</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a15 0%, #1a1a2e 100%);
            color: #e8e8e8;
            min-height: 100vh;
        }

        /* Navigation */
        nav {
            background: linear-gradient(90deg, #0d0d14, #1a1a2e);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #2a2a3e;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .nav-brand { display: flex; align-items: center; gap: 8px; }
        .nav-brand span:first-child { font-size: 20px; }
        .nav-brand span:last-child { font-weight: 700; color: #ffd700; }
        .nav-links { display: flex; gap: 5px; flex-wrap: wrap; }
        .nav-links a {
            padding: 8px 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            color: #e0e0e0;
            text-decoration: none;
            font-size: 12px;
            transition: all 0.2s;
        }
        .nav-links a:hover { background: rgba(255,215,0,0.2); }
        .nav-links a.active { background: rgba(255,215,0,0.3); color: #ffd700; }
        .nav-price { display: flex; align-items: center; gap: 10px; }
        #navPrice { font-family: monospace; font-size: 16px; color: #ffd700; }
        #navLive { width: 8px; height: 8px; background: #666; border-radius: 50%; }

        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }

        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { font-size: 1.8em; color: #ffd700; }
        .header .subtitle { color: #6b7280; font-size: 0.9em; }

        /* Presets */
        .presets {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .preset-btn {
            padding: 12px 20px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            color: #e8e8e8;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .preset-btn:hover { border-color: #ffd700; background: rgba(255,215,0,0.1); }
        .preset-btn.active { border-color: #ffd700; background: rgba(255,215,0,0.2); color: #ffd700; }
        .preset-btn .name { font-weight: 600; }
        .preset-btn .desc { font-size: 0.8em; color: #9ca3af; margin-top: 3px; }

        /* Config Panel */
        .config-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .config-title { color: #ffd700; font-size: 1.1em; margin-bottom: 15px; }
        .config-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        @media (max-width: 600px) { .config-grid { grid-template-columns: repeat(2, 1fr); } }
        .config-item { text-align: center; }
        .config-label { font-size: 0.8em; color: #6b7280; margin-bottom: 5px; }
        .config-input {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            color: #ffd700;
            font-size: 1.2em;
            text-align: center;
            font-family: monospace;
        }
        .config-input:focus { outline: none; border-color: #ffd700; }

        .config-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .action-btn.start { background: #22c55e; color: white; }
        .action-btn.start:hover { background: #16a34a; }
        .action-btn.stop { background: #ef4444; color: white; }
        .action-btn.stop:hover { background: #dc2626; }
        .action-btn.reset { background: rgba(255,255,255,0.1); color: #e8e8e8; }
        .action-btn.reset:hover { background: rgba(255,255,255,0.2); }
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Active Trade */
        .active-trade {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid transparent;
        }
        .active-trade.has-trade { border-color: #3b82f6; box-shadow: 0 0 20px rgba(59, 130, 246, 0.2); }
        .active-trade.long { border-color: #22c55e; box-shadow: 0 0 20px rgba(34, 197, 94, 0.2); }
        .active-trade.short { border-color: #ef4444; box-shadow: 0 0 20px rgba(239, 68, 68, 0.2); }
        .trade-title { color: #ffd700; font-size: 1.1em; margin-bottom: 15px; }
        .no-trade { color: #6b7280; text-align: center; padding: 20px; }
        .trade-info {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            text-align: center;
        }
        .trade-field .label { font-size: 0.75em; color: #6b7280; }
        .trade-field .value { font-size: 1.3em; font-family: monospace; margin-top: 5px; }
        .trade-field .value.long { color: #22c55e; }
        .trade-field .value.short { color: #ef4444; }
        .trade-field .value.profit { color: #22c55e; }
        .trade-field .value.loss { color: #ef4444; }

        .trade-progress {
            margin-top: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            height: 30px;
            position: relative;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            transition: width 0.3s;
            border-radius: 10px;
        }
        .progress-bar.profit { background: linear-gradient(90deg, #22c55e, #16a34a); }
        .progress-bar.loss { background: linear-gradient(90deg, #ef4444, #dc2626); }
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 600;
            font-size: 0.9em;
        }

        /* Statistics */
        .stats-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .stats-title { color: #ffd700; font-size: 1.1em; margin-bottom: 15px; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            text-align: center;
        }
        @media (max-width: 600px) { .stats-grid { grid-template-columns: repeat(3, 1fr); } }
        .stat-item .label { font-size: 0.75em; color: #6b7280; }
        .stat-item .value { font-size: 1.5em; font-weight: 700; margin-top: 5px; }
        .stat-item .value.positive { color: #22c55e; }
        .stat-item .value.negative { color: #ef4444; }
        .stat-item .value.neutral { color: #ffd700; }

        /* Trade Log */
        .trade-log {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-title { color: #ffd700; font-size: 1.1em; margin-bottom: 15px; display: flex; justify-content: space-between; }
        .log-entry {
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 8px;
            font-size: 0.9em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .log-entry.win { background: rgba(34, 197, 94, 0.15); border-left: 3px solid #22c55e; }
        .log-entry.loss { background: rgba(239, 68, 68, 0.15); border-left: 3px solid #ef4444; }
        .log-entry.open { background: rgba(59, 130, 246, 0.15); border-left: 3px solid #3b82f6; }
        .log-entry .time { color: #6b7280; font-family: monospace; font-size: 0.8em; }
        .log-entry .details { flex: 1; margin: 0 15px; }
        .log-entry .pnl { font-weight: 600; font-family: monospace; }
        .log-entry .pnl.positive { color: #22c55e; }
        .log-entry .pnl.negative { color: #ef4444; }

        .empty-log { color: #6b7280; text-align: center; padding: 20px; }

        /* Status indicator */
        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        .status-dot.active { background: #22c55e; animation: pulse 1s infinite; }
        .status-dot.inactive { background: #6b7280; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-brand">
            <span>&#9889;</span>
            <span>Gold Intelligence V2.0</span>
        </div>
        <div class="nav-links">
            <a href="index.html">&#128202; Dashboard</a>
            <a href="station.html">&#9889; Station</a>
            <a href="smart.html">&#128161; Smart</a>
            <a href="simulator.html" class="active">&#128200; Simulator</a>
            <a href="strategies.html">&#128218; Strategier</a>
            <a href="lab.html">&#128300; Lab</a>
        </div>
        <div class="nav-price">
            <span id="navPrice">--</span>
            <span id="navLive"></span>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <h1>&#128200; Trade Simulator</h1>
            <p class="subtitle">Paper Trading - Test dine strategier uden risiko</p>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <span class="status-dot" id="simStatus"></span>
                <span id="simStatusText">Stoppet</span>
            </div>
            <div class="status-item">
                <span>Pris:</span>
                <span id="currentPrice" style="color: #ffd700; font-family: monospace;">$--</span>
            </div>
            <div class="status-item">
                <span>Score:</span>
                <span id="currentScore" style="font-family: monospace;">L:-- S:--</span>
            </div>
        </div>

        <!-- Presets -->
        <div class="presets">
            <button class="preset-btn" onclick="loadPreset(0)">
                <div class="name">Safe $3 Wide</div>
                <div class="desc">SL: $30 | TP: $3 | Score: 40</div>
            </button>
            <button class="preset-btn" onclick="loadPreset(1)">
                <div class="name">Safe $4 Wide</div>
                <div class="desc">SL: $40 | TP: $4 | Score: 40</div>
            </button>
            <button class="preset-btn" onclick="loadPreset(2)">
                <div class="name">Safe $5 Wide</div>
                <div class="desc">SL: $50 | TP: $5 | Score: 40</div>
            </button>
        </div>

        <!-- Config Panel -->
        <div class="config-panel">
            <div class="config-title">&#9881; Konfiguration</div>
            <div class="config-grid">
                <div class="config-item">
                    <div class="config-label">Stop Loss ($)</div>
                    <input type="number" class="config-input" id="inputSL" value="30">
                </div>
                <div class="config-item">
                    <div class="config-label">Take Profit ($)</div>
                    <input type="number" class="config-input" id="inputTP" value="3">
                </div>
                <div class="config-item">
                    <div class="config-label">Min Score</div>
                    <input type="number" class="config-input" id="inputScore" value="40">
                </div>
                <div class="config-item">
                    <div class="config-label">Max Trades</div>
                    <input type="number" class="config-input" id="inputMaxTrades" value="100">
                </div>
            </div>
            <div class="config-actions">
                <button class="action-btn start" id="btnStart" onclick="startSimulation()">&#9654; Start Simulation</button>
                <button class="action-btn stop" id="btnStop" onclick="stopSimulation()" disabled>&#9632; Stop</button>
                <button class="action-btn reset" onclick="resetStats()">&#128260; Reset Stats</button>
            </div>
        </div>

        <!-- Active Trade -->
        <div class="active-trade" id="activeTrade">
            <div class="trade-title">&#128205; Aktiv Trade</div>
            <div class="no-trade" id="noTrade">Ingen aktiv trade - venter på signal...</div>
            <div class="trade-info" id="tradeInfo" style="display: none;">
                <div class="trade-field">
                    <div class="label">RETNING</div>
                    <div class="value" id="tradeDirection">--</div>
                </div>
                <div class="trade-field">
                    <div class="label">ENTRY</div>
                    <div class="value" id="tradeEntry">--</div>
                </div>
                <div class="trade-field">
                    <div class="label">TARGET</div>
                    <div class="value" id="tradeTarget">--</div>
                </div>
                <div class="trade-field">
                    <div class="label">STOP</div>
                    <div class="value" id="tradeStop">--</div>
                </div>
            </div>
            <div class="trade-progress" id="tradeProgress" style="display: none;">
                <div class="progress-bar" id="progressBar"></div>
                <div class="progress-text" id="progressText">$0.0</div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-panel">
            <div class="stats-title">&#128202; Statistik</div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="label">TRADES</div>
                    <div class="value neutral" id="statTrades">0</div>
                </div>
                <div class="stat-item">
                    <div class="label">WINS</div>
                    <div class="value positive" id="statWins">0</div>
                </div>
                <div class="stat-item">
                    <div class="label">LOSSES</div>
                    <div class="value negative" id="statLosses">0</div>
                </div>
                <div class="stat-item">
                    <div class="label">WIN RATE</div>
                    <div class="value neutral" id="statWinRate">0%</div>
                </div>
                <div class="stat-item">
                    <div class="label">TOTAL PnL</div>
                    <div class="value neutral" id="statPnL">$0</div>
                </div>
            </div>
        </div>

        <!-- Trade Log -->
        <div class="trade-log">
            <div class="log-title">
                <span>&#128220; Trade Log</span>
                <button class="action-btn reset" style="padding: 5px 10px; font-size: 12px;" onclick="exportLog()">Export JSON</button>
            </div>
            <div id="logContainer">
                <div class="empty-log">Ingen trades endnu - start simulationen for at begynde</div>
            </div>
        </div>
    </div>

    <script>
        // ============ CONFIG ============
        const FIREBASE_URL = 'https://online-shopping-a7061.firebaseio.com/gold-live.json';

        // Presets from run_all_tests.py (best performing)
        const PRESETS = [
            { name: 'Safe $3 Wide', sl: 30, tp: 3, minScore: 40 },
            { name: 'Safe $4 Wide', sl: 40, tp: 4, minScore: 40 },
            { name: 'Safe $5 Wide', sl: 50, tp: 5, minScore: 40 }
        ];

        // State
        let isRunning = false;
        let currentTrade = null;
        let stats = { trades: 0, wins: 0, losses: 0, totalPnL: 0 };
        let tradeLog = [];
        let lastPrice = 0;
        let lastSignal = null;

        // Config
        let config = {
            sl: 30,
            tp: 3,
            minScore: 40,
            maxTrades: 100
        };

        // ============ PRESETS ============
        function loadPreset(index) {
            const preset = PRESETS[index];
            document.getElementById('inputSL').value = preset.sl;
            document.getElementById('inputTP').value = preset.tp;
            document.getElementById('inputScore').value = preset.minScore;

            // Update active button
            document.querySelectorAll('.preset-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });

            config.sl = preset.sl;
            config.tp = preset.tp;
            config.minScore = preset.minScore;
        }

        // ============ SIMULATION CONTROL ============
        function startSimulation() {
            config.sl = parseFloat(document.getElementById('inputSL').value);
            config.tp = parseFloat(document.getElementById('inputTP').value);
            config.minScore = parseFloat(document.getElementById('inputScore').value);
            config.maxTrades = parseInt(document.getElementById('inputMaxTrades').value);

            isRunning = true;
            document.getElementById('btnStart').disabled = true;
            document.getElementById('btnStop').disabled = false;
            document.getElementById('simStatus').className = 'status-dot active';
            document.getElementById('simStatusText').textContent = 'Kører...';

            addLogEntry('system', 'Simulation startet', `SL: $${config.sl} | TP: $${config.tp} | Min Score: ${config.minScore}`);
        }

        function stopSimulation() {
            isRunning = false;
            document.getElementById('btnStart').disabled = false;
            document.getElementById('btnStop').disabled = true;
            document.getElementById('simStatus').className = 'status-dot inactive';
            document.getElementById('simStatusText').textContent = 'Stoppet';

            addLogEntry('system', 'Simulation stoppet', `Trades: ${stats.trades} | PnL: $${stats.totalPnL.toFixed(1)}`);
        }

        function resetStats() {
            if (currentTrade) {
                closeTrade('reset');
            }
            stats = { trades: 0, wins: 0, losses: 0, totalPnL: 0 };
            tradeLog = [];
            updateStatsUI();
            updateLogUI();
            saveState();
        }

        // ============ TRADE MANAGEMENT ============
        function openTrade(direction, price, scoreLong, scoreShort) {
            if (currentTrade || !isRunning) return;
            if (stats.trades >= config.maxTrades) {
                stopSimulation();
                return;
            }

            const entry = price;
            const target = direction === 'LONG' ? entry + config.tp : entry - config.tp;
            const stop = direction === 'LONG' ? entry - config.sl : entry + config.sl;

            currentTrade = {
                direction,
                entry,
                target,
                stop,
                openTime: new Date(),
                scoreLong,
                scoreShort
            };

            updateTradeUI();
            addLogEntry('open', `${direction} @ $${entry.toFixed(1)}`, `Target: $${target.toFixed(1)} | Stop: $${stop.toFixed(1)}`);
        }

        function closeTrade(reason, exitPrice = lastPrice) {
            if (!currentTrade) return;

            const pnl = currentTrade.direction === 'LONG'
                ? exitPrice - currentTrade.entry
                : currentTrade.entry - exitPrice;

            const isWin = reason === 'tp';
            const isLoss = reason === 'sl';

            stats.trades++;
            if (isWin) stats.wins++;
            if (isLoss) stats.losses++;
            stats.totalPnL += pnl;

            const resultText = isWin ? 'WIN' : isLoss ? 'LOSS' : 'CLOSED';
            addLogEntry(isWin ? 'win' : isLoss ? 'loss' : 'open',
                `${currentTrade.direction} ${resultText}`,
                `Entry: $${currentTrade.entry.toFixed(1)} → Exit: $${exitPrice.toFixed(1)} | PnL: ${pnl >= 0 ? '+' : ''}$${pnl.toFixed(1)}`
            );

            currentTrade = null;
            updateTradeUI();
            updateStatsUI();
            saveState();
        }

        function checkTrade(price) {
            if (!currentTrade || !isRunning) return;

            if (currentTrade.direction === 'LONG') {
                if (price >= currentTrade.target) {
                    closeTrade('tp', currentTrade.target);
                } else if (price <= currentTrade.stop) {
                    closeTrade('sl', currentTrade.stop);
                }
            } else {
                if (price <= currentTrade.target) {
                    closeTrade('tp', currentTrade.target);
                } else if (price >= currentTrade.stop) {
                    closeTrade('sl', currentTrade.stop);
                }
            }
        }

        // ============ UI UPDATES ============
        function updateTradeUI() {
            const tradePanel = document.getElementById('activeTrade');
            const noTrade = document.getElementById('noTrade');
            const tradeInfo = document.getElementById('tradeInfo');
            const tradeProgress = document.getElementById('tradeProgress');

            if (currentTrade) {
                noTrade.style.display = 'none';
                tradeInfo.style.display = 'grid';
                tradeProgress.style.display = 'block';
                tradePanel.className = 'active-trade has-trade ' + currentTrade.direction.toLowerCase();

                const dirEl = document.getElementById('tradeDirection');
                dirEl.textContent = currentTrade.direction;
                dirEl.className = 'value ' + currentTrade.direction.toLowerCase();

                document.getElementById('tradeEntry').textContent = '$' + currentTrade.entry.toFixed(1);
                document.getElementById('tradeTarget').textContent = '$' + currentTrade.target.toFixed(1);
                document.getElementById('tradeStop').textContent = '$' + currentTrade.stop.toFixed(1);

                updateProgressBar();
            } else {
                noTrade.style.display = 'block';
                tradeInfo.style.display = 'none';
                tradeProgress.style.display = 'none';
                tradePanel.className = 'active-trade';
            }
        }

        function updateProgressBar() {
            if (!currentTrade) return;

            const pnl = currentTrade.direction === 'LONG'
                ? lastPrice - currentTrade.entry
                : currentTrade.entry - lastPrice;

            const maxMove = Math.max(config.tp, config.sl);
            const progress = Math.min(100, Math.abs(pnl / maxMove * 100));

            const bar = document.getElementById('progressBar');
            const text = document.getElementById('progressText');

            bar.style.width = progress + '%';
            bar.className = 'progress-bar ' + (pnl >= 0 ? 'profit' : 'loss');
            text.textContent = (pnl >= 0 ? '+' : '') + '$' + pnl.toFixed(1);
        }

        function updateStatsUI() {
            document.getElementById('statTrades').textContent = stats.trades;
            document.getElementById('statWins').textContent = stats.wins;
            document.getElementById('statLosses').textContent = stats.losses;

            const winRate = stats.trades > 0 ? (stats.wins / stats.trades * 100) : 0;
            document.getElementById('statWinRate').textContent = winRate.toFixed(0) + '%';

            const pnlEl = document.getElementById('statPnL');
            pnlEl.textContent = (stats.totalPnL >= 0 ? '+' : '') + '$' + stats.totalPnL.toFixed(1);
            pnlEl.className = 'value ' + (stats.totalPnL > 0 ? 'positive' : stats.totalPnL < 0 ? 'negative' : 'neutral');
        }

        function addLogEntry(type, title, details) {
            tradeLog.unshift({
                type,
                title,
                details,
                time: new Date().toLocaleTimeString('da-DK', { hour: '2-digit', minute: '2-digit', second: '2-digit' })
            });

            if (tradeLog.length > 100) tradeLog.pop();
            updateLogUI();
        }

        function updateLogUI() {
            const container = document.getElementById('logContainer');

            if (tradeLog.length === 0) {
                container.innerHTML = '<div class="empty-log">Ingen trades endnu - start simulationen for at begynde</div>';
                return;
            }

            container.innerHTML = tradeLog.map(entry => {
                const cssClass = entry.type === 'win' ? 'win' : entry.type === 'loss' ? 'loss' : 'open';
                return `
                    <div class="log-entry ${cssClass}">
                        <span class="time">${entry.time}</span>
                        <span class="details"><strong>${entry.title}</strong> - ${entry.details}</span>
                    </div>
                `;
            }).join('');
        }

        // ============ DATA FETCHING ============
        async function fetchData() {
            try {
                const res = await fetch(FIREBASE_URL);
                const data = await res.json();
                if (data) {
                    const keys = Object.keys(data);
                    return data[keys[keys.length - 1]];
                }
            } catch (e) {
                console.error('Fetch error:', e);
            }
            return null;
        }

        function processData(data) {
            if (!data) {
                document.getElementById('navLive').style.background = '#ef4444';
                return;
            }

            const price = data.price || 0;
            const scoreLong = data.score_long || 0;
            const scoreShort = data.score_short || 0;

            lastPrice = price;

            // Update UI
            document.getElementById('navPrice').textContent = '$' + price.toFixed(1);
            document.getElementById('navLive').style.background = '#22c55e';
            document.getElementById('currentPrice').textContent = '$' + price.toFixed(1);
            document.getElementById('currentScore').textContent = `L:${scoreLong} S:${scoreShort}`;

            // Check existing trade
            if (currentTrade) {
                checkTrade(price);
                updateProgressBar();
            }

            // Check for new signals (only if running and no current trade)
            if (isRunning && !currentTrade) {
                if (scoreLong >= config.minScore && scoreLong > scoreShort) {
                    openTrade('LONG', price, scoreLong, scoreShort);
                } else if (scoreShort >= config.minScore && scoreShort > scoreLong) {
                    openTrade('SHORT', price, scoreLong, scoreShort);
                }
            }
        }

        // ============ STORAGE ============
        function saveState() {
            const state = { stats, tradeLog, config };
            localStorage.setItem('tradeSimulator', JSON.stringify(state));
        }

        function loadState() {
            try {
                const saved = localStorage.getItem('tradeSimulator');
                if (saved) {
                    const state = JSON.parse(saved);
                    stats = state.stats || stats;
                    tradeLog = state.tradeLog || [];
                    if (state.config) {
                        config = state.config;
                        document.getElementById('inputSL').value = config.sl;
                        document.getElementById('inputTP').value = config.tp;
                        document.getElementById('inputScore').value = config.minScore;
                        document.getElementById('inputMaxTrades').value = config.maxTrades;
                    }
                }
            } catch (e) {
                console.log('No saved state');
            }
            updateStatsUI();
            updateLogUI();
        }

        function exportLog() {
            const exportData = {
                config,
                stats,
                tradeLog,
                exportTime: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trade_simulation_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        // ============ INIT ============
        loadState();
        loadPreset(0); // Load first preset

        // Fetch data every 3 seconds
        fetchData().then(processData);
        setInterval(() => fetchData().then(processData), 3000);
    </script>
</body>
</html>
